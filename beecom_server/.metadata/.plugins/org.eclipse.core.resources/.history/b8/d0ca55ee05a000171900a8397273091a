/**
 * 
 */
package bc_server;

import java.util.HashMap;
import java.util.Vector;

/**
 * @author Ansersion
 * 
 */

class SigData {
	boolean HasCustomSig;
	Vector<Short> Vct1ByteDataSig;
	Vector<Short> Vct2ByteDataSig;
	Vector<Short> Vct4ByteDataSig;

	Vector<Short> VctNoCustomSig;

	SigData() {
		Vct1ByteDataSig = new Vector<Short>();
		Vct2ByteDataSig = new Vector<Short>();
		Vct4ByteDataSig = new Vector<Short>();
		VctNoCustomSig = new Vector<Short>();

	}

	SigData(boolean custom_sig_flag) {
		HasCustomSig = custom_sig_flag;
		if (HasCustomSig) {
			Vct1ByteDataSig = new Vector<Short>();
			Vct2ByteDataSig = new Vector<Short>();
			Vct4ByteDataSig = new Vector<Short>();
		} else {
			VctNoCustomSig = new Vector<Short>();
		}
	}

	public void setCustomSigFlag(boolean custom_sig_flag) {
		HasCustomSig = custom_sig_flag;
	}

	public boolean getCustomSigFlag() {
		return HasCustomSig;
	}
	
	public void addNoCusSig(short sig) {
		VctNoCustomSig.add(sig);
	}

	public int parseSigData(byte[] data, int offset) {
		int offset_old = offset;

		int type_and_num = data[offset++];

		// boolean = (type_and_num >> 6) & 0x3;
		int type = 0;
		int num = type_and_num & 0x3F;

		if (0x00 == type) {
			for (int i = 0; i < num; i++) {
				byte sig_msb = data[offset++];
				byte sig_lsb = data[offset++];
				Vct1ByteDataSig.add(BPPacket.assemble2ByteBigend(sig_msb,
						sig_lsb));
			}
		} else if (0x01 == type) {
			for (int i = 0; i < num; i++) {
				byte sig_msb = data[offset++];
				byte sig_lsb = data[offset++];
				Vct2ByteDataSig.add(BPPacket.assemble2ByteBigend(sig_msb,
						sig_lsb));
			}
		} else if (0x10 == type) {
			for (int i = 0; i < num; i++) {
				byte sig_msb = data[offset++];
				byte sig_lsb = data[offset++];
				Vct2ByteDataSig.add(BPPacket.assemble2ByteBigend(sig_msb,
						sig_lsb));
			}
		} else {
			System.out.println("ValueType " + type + " Not supported yet");
		}

		return offset - offset_old;
	}
}

public class DeviceSignalData {
	Short DevId[];
	HashMap<Short, SigData> SigDataMap;

	// int CusValTypeNum;

	public DeviceSignalData(int DevNum) {
		DevId = new Short[DevNum];
		SigDataMap = new HashMap<Short, SigData>();
		// HasCustomSig = false;
		// CusValTypeNum = 0;
	}

	public int parseSigMap(byte[] data, int offset) {
		int offset_old = offset;
		byte encoded_byte;
		
		for (int i = 0; i < DevId.length; i++) {
			DevId[i] = BPPacket.assemble2ByteBigend(data, offset);
			offset += 2;
			encoded_byte = data[offset++];
			
			SigDataMap.put(DevId[i], new SigData((encoded_byte & 0x80) == 0x80));

			boolean custom_sig_flag = (encoded_byte & 0x80) == 0x80;
			if(custom_sig_flag) {
				int CusValTypeNum = encoded_byte & 0x03;
			} else {
				encoded_byte = data[offset++];
				int sig_num = encoded_byte & 0x3F;
				SigDataMap.put(DevId[i],  new SigData(custom_sig_flag));
				for(int j = 0; j < sig_num; j++) {
					short sig = BPPacket.assemble2ByteBigend(data, offset);
					SigDataMap[DevId[i]].addNoCusSig(sig);
				}
			}

			encoded_byte = data[offset++];
			
			SigDataMap.
			encoded_byte = data[offset++];

			if (HasCustomSig) {

			} else {

			}
		}

		/*
		 * for(int i = 0; i < ValueTypeNum; i++) { encoded_byte =
		 * data[offset++]; }
		 */

		return offset - offset_old;
	}
}
